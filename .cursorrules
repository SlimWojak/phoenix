# Phoenix Project Rules
# Constitutional Trading System — First Application on God_Mode Governance

## PROJECT CONTEXT

Phoenix is the trading execution layer built on God_Mode governance patterns.
- Sibling to God_Mode (Forge = OS, Phoenix = App)
- Current: S29 BUILD_MAP locked, S30 LEARNING_LOOP next
- Constitutional anchor: Human sovereignty over capital is absolute

## COMMUNICATION FORMAT

DENSE M2M (machine-to-machine):
- No prose, no filler
- YAML/structured output preferred
- Action-oriented responses
- Reference INV-* invariants by ID

## CODE STANDARDS

### File Size
- NEW files: ≤300 lines (enforced)
- Existing S28 files: grandfathered (see GRANDFATHERED_FILES.md)
- Forces decomposition into focused modules

### Type Hints
- REQUIRED on all functions
- mypy --strict enforced in CI
- No `Any` without documented reason

### Logging
- NO print() statements
- Use structlog for all output
- Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL

### Imports
Order:
1. stdlib
2. third-party
3. local (phoenix.*)

### Test Files
- Location: tests/ (mirrors src structure)
- Naming: test_*.py
- Invariant tests: mark with @pytest.mark.invariant

## INVARIANT REFERENCES

When writing code that enforces constitutional invariants, comment with INV-* ID:

```python
# INV-HALT-1: Local halt < 50ms
def halt(self) -> None:
    self._halted.set()  # Threading event, ~0.003ms
```

## KEY INVARIANTS

| ID | Description | Target |
|----|-------------|--------|
| INV-HALT-1 | Local halt latency | <50ms |
| INV-HALT-2 | Cascade halt | <500ms |
| INV-CONTRACT-1 | Deterministic state | Hash match |
| INV-DATA-CANON | Single truth source | River only |
| INV-GOV-HALT-BEFORE-ACTION | Check halt first | Always |
| INV-EXEC-LIFECYCLE-1 | Valid state transitions | Enforced |

## TIER SYSTEM

- Tier 0: Read-only, auto-approve
- Tier 1: Side effects, auto-approve with logging
- Tier 2: Capital-affecting, HUMAN GATE REQUIRED

## FILE LOCATIONS

| Purpose | Location |
|---------|----------|
| Source code | phoenix/* (current structure) |
| Tests | tests/ |
| Docs | docs/ |
| Schemas | schemas/ |
| Scripts | scripts/ |
| Config | config/ |
| Archive | docs/archive_docs/ |

## QUICK REFERENCES

- Vision: docs/build_docs/PRODUCT_VISION.md
- Constitution: CONSTITUTION/invariants/
- Current sprint: docs/build_docs/S29_BUILD_MAP_v0.2.md
- Roadmap: docs/build_docs/SPRINT_ROADMAP_S30_S33_v0.2.md
